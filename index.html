<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IntelliHub - AI智能交互中心</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --gradient-start: #4F46E5;
            --gradient-end: #06B6D4;
        }
        .hidden {
            display: none;
        }
        .gradient-text {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .gradient-bg {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
        }
        .hover-scale {
            transition: transform 0.2s;
        }
        .hover-scale:hover {
            transform: scale(1.02);
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 150px;
            height: 150px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -75px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .tooltip .tooltiptext img {
            width: 140px;
            height: 140px;
            border-radius: 4px;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        #text-slider {
            position: relative;
            height: 2rem;
        }
        #text-slider p {
            position: absolute;
            width: 100%;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease-in-out;
        }
        #text-slider p.active {
            opacity: 1;
            transform: translateY(0);
        }
        #login-section {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .login-container {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        /* 添加用户弹窗使用更高的 z-index */
        #add-user-modal {
            z-index: 1001;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-gray-50">
    <!-- 登录界面 -->
    <div id="login-section" class="fixed inset-0 bg-gradient-to-br from-indigo-600 to-blue-500 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl shadow-2xl w-96">
            <div class="text-center mb-8">
                <h1 class="text-2xl font-bold gradient-text">IntelliHub</h1>
                <p class="text-gray-600">请登录以继续</p>
            </div>
            <form id="login-form" class="space-y-6" onsubmit="handleLogin(event)">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                    <input
                        type="text"
                        id="login-username"
                        required
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                    />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                    <input
                        type="password"
                        id="login-password"
                        required
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                    />
                </div>
                <button
                    type="submit"
                    class="w-full py-3 gradient-bg text-white rounded-lg hover-scale"
                >
                    登录
                </button>
            </form>
        </div>
    </div>

    <!-- 导航栏 -->
    <header class="bg-white/80 backdrop-blur-md shadow-lg fixed w-full z-50">
        <nav class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="text-2xl font-bold flex items-center space-x-2">
                    <i class="fas fa-brain gradient-text"></i>
                    <span class="gradient-text">IntelliHub</span>
                </div>
                <div class="space-x-4">
                    <button onclick="showSection('home')" class="px-4 py-2 rounded-full hover:bg-gray-100 transition-all" id="nav-home">主页</button>
                    <button onclick="showSection('about')" class="px-4 py-2 rounded-full hover:bg-gray-100 transition-all" id="nav-about">关于与联系</button>
                    <button onclick="showSection('profile')" class="px-4 py-2 rounded-full hover:bg-gray-100 transition-all" id="nav-profile">
                        <i class="fas fa-user"></i>
                        <span id="profile-username">个人主页</span>
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- 主要内容区域 -->
    <main class="flex-grow container mx-auto px-4 pt-24 pb-8">
        <!-- 首页内容 -->
        <div id="home-section" class="space-y-8">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-4 gradient-text">
                    IntelliHub
                </h1>
                <div id="text-slider" class="mx-auto max-w-2xl">
                    <p class="text-gray-600 active">与多个AI模型同时对话，获取全方位的智能解答</p>
                    <p class="text-gray-600">汇集顶尖AI模型，激发无限创意灵感</p>
                    <p class="text-gray-600">一站式AI智能交互平台，让决策更明智</p>
                    <p class="text-gray-600">多维度解析问题，提供专业智能建议</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- AI选择器 -->
                <div class="md:col-span-3">
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold gradient-text">选择AI助手</h3>
                        <div class="flex flex-wrap gap-4" id="ai-options">
                            <!-- AI选项将通过JavaScript动态添加 -->
                        </div>
                    </div>
                </div>

                <!-- 问题输入和响应显示 -->
                <div class="md:col-span-3">
                    <div class="space-y-4">
                        <div class="flex space-x-4">
                            <textarea id="question-input" rows="3" class="flex-1 p-4 rounded-xl border focus:ring-2 focus:ring-indigo-500 resize-none" placeholder="请输入您的问题..."></textarea>
                            <button id="submit-button" onclick="handleSubmitQuestion()" class="px-6 gradient-bg text-white rounded-xl hover:opacity-90 flex items-center space-x-2">
                                <i class="fas fa-paper-plane"></i>
                                <span>发送</span>
                            </button>
                        </div>
                    </div>
                    <div id="responses-container" class="mt-8 space-y-6 hidden overflow-y-auto max-h-[600px]">
                        <h3 class="text-lg font-semibold gradient-text">AI智能解答</h3>
                        <div id="responses-list" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <!-- 响应将通过JavaScript动态添加 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 关于与联系页面 -->
        <div id="about-section" class="max-w-5xl mx-auto hidden">
            <h1 class="text-4xl font-bold mb-12 text-center gradient-text">关于我们</h1>
            
            <!-- 关于我们部分 -->
            <div class="mb-16">
                <div class="text-center mb-12">
                     <h2 class="text-2xl font-semibold mb-4">我们的使命</h2>
                     <p class="text-gray-700 max-w-3xl mx-auto">
                         我们致力于为用户提供一个集成多个AI模型的问答平台，
                         让用户能够便捷地获取多个AI的观点和答案，从而做出更好的决策。
                     </p>
                </div>

                <div class="mb-12">
                    <h2 class="text-2xl font-semibold mb-8 text-center">我们的特点</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                             <div class="bg-white p-4 rounded-lg shadow">
                                 <h3 class="text-lg font-medium text-blue-600">多AI集成</h3>
                                 <p class="text-gray-600">集成多个主流AI模型，提供多样化的答案和见解。</p>
                             </div>
                             <div class="bg-white p-4 rounded-lg shadow">
                                 <h3 class="text-lg font-medium text-blue-600">便捷操作</h3>
                                 <p class="text-gray-600">简单直观的界面设计，一键式操作体验。</p>
                             </div>
                             <div class="bg-white p-4 rounded-lg shadow">
                                 <h3 class="text-lg font-medium text-blue-600">实时响应</h3>
                                 <p class="text-gray-600">快速获取多个AI的回答，提高决策效率。</p>
                             </div>
                     </div>
                 </div>
            </div>

            <!-- 联系我们部分 -->
            <div class="border-t pt-16">
                <h2 class="text-3xl font-semibold mb-8 text-center">联系我们</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 max-w-4xl mx-auto">
                    <!-- 联系表单 -->
                    <div class="space-y-6">
                     <form id="contact-form" class="space-y-6">
                         <div>
                             <label for="name" class="block text-sm font-medium text-gray-700 mb-1">姓名</label>
                             <input
                                 type="text"
                                 id="name"
                                 name="name"
                                 required
                                 class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                             />
                         </div>
                         <div>
                             <label for="email" class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
                             <input
                                 type="email"
                                 id="email"
                                 name="email"
                                 required
                                 class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                             />
                         </div>
                         <div>
                             <label for="message" class="block text-sm font-medium text-gray-700 mb-1">留言</label>
                             <textarea
                                 id="message"
                                 name="message"
                                 required
                                 rows="4"
                                 class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
                             ></textarea>
                         </div>
                         <button
                             type="submit"
                             class="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                         >
                             发送消息
                         </button>
                     </form>
                    </div>

                    <!-- 其他联系方式 -->
                    <div class="bg-white p-8 rounded-lg shadow-lg space-y-6">
                         <h3 class="text-lg font-medium text-blue-600">其他联系方式</h3>
                         <div class="space-y-4 text-gray-600">
                             <p class="flex items-center">
                                 <i class="fas fa-envelope w-6"></i>
                                 <span>1348293796@qq.com</span>
                             </p>
                             <p class="flex items-center">
                                 <i class="fas fa-phone w-6"></i>
                                 <span>17611133337</span>
                             </p>
                             <p class="flex items-center">
                                 <i class="fas fa-map-marker-alt w-6"></i>
                                 <span>xxx</span>
                             </p>
                         </div>
                     </div>
                 </div>
             </div>
         </div>

        <!-- 个人主页 -->
        <div id="profile-section" class="max-w-4xl mx-auto hidden">
            <h1 class="text-4xl font-bold mb-8 text-center gradient-text">个人主页</h1>
            
            <!-- 功能按钮 - 竖向排列 -->
            <div class="max-w-md mx-auto space-y-3">
                 <!-- 个人信息按钮 -->
                <button onclick="showModal('profile-info-modal')" 
                    class="p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all w-full text-left flex items-center">
                     <i class="fas fa-user text-indigo-600"></i>
                     <span class="ml-2">个人信息</span>
                 </button>
                 <!-- 修改密码按钮 -->
                <button onclick="showModal('change-password-modal')" 
                    class="p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all w-full text-left flex items-center">
                     <i class="fas fa-key text-indigo-600"></i>
                     <span class="ml-2">修改密码</span>
                 </button>
                 <!-- 搜索历史按钮 -->
                <button onclick="showModal('search-history-modal')" 
                    class="p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all w-full text-left flex items-center">
                     <i class="fas fa-history text-indigo-600"></i>
                     <span class="ml-2">查看搜索历史</span>
                 </button>
                 <!-- 管理员专属：用户管理按钮 -->
                <button onclick="showModal('user-management-modal')" id="admin-button" 
                    class="p-3 bg-white rounded-lg shadow-sm hover:shadow-md transition-all w-full text-left flex items-center hidden">
                     <i class="fas fa-users text-indigo-600"></i>
                     <span class="ml-2">用户管理</span>
                 </button>
             </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-100 py-6">
        <div class="container mx-auto px-4">
            <div class="flex flex-col items-center space-y-3">
                <div class="text-xs text-gray-500">
                    © 2024 IntelliHub. 保留所有权利
                </div>
                <div class="space-x-6">
                    <div class="tooltip">
                        <i class="fab fa-weixin text-xl text-gray-500 hover:text-green-600 cursor-pointer"></i>
                        <span class="tooltiptext">
                            <img src="imgs/qq.jpg" alt="微信二维码" />
                        </span>
                    </div>
                    <div class="tooltip">
                        <i class="fab fa-qq text-xl text-gray-500 hover:text-blue-600 cursor-pointer"></i>
                        <span class="tooltiptext">
                            <img src="imgs/wx.jpg" alt="QQ二维码" />
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- 创建用户弹窗 -->
    <div id="create-user-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">用户管理</h3>
                <button onclick="closeModal('create-user-modal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- 用户列表 -->
            <div id="users-list" class="mb-8 space-y-2">
                 <!-- 用户列表将通过JavaScript动态添加 -->
             </div>
             
             <div class="border-t pt-6">
                 <h4 class="text-lg font-medium mb-4">创建新用户</h4>
                 <form id="create-user-form" class="space-y-4">
                     <div>
                         <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                         <input
                             type="text"
                             id="new-username"
                             class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                             required
                         />
                     </div>
                     <p class="text-sm text-gray-500">注：新用户的初始密码为 000000</p>
                     <div class="flex space-x-4">
                         <button type="submit" class="flex-1 px-6 py-3 gradient-bg text-white rounded-lg hover-scale">
                             创建用户
                         </button>
                         <button type="button" onclick="closeModal('create-user-modal')"
                                 class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                             取消
                         </button>
                     </div>
                 </form>
             </div>
         </div>
     </div>

    <!-- 修改密码弹窗 -->
    <div id="change-password-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">修改密码</h3>
                <button onclick="closeModal('change-password-modal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="change-password-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">当前密码</label>
                    <input
                        type="password"
                        id="current-password"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">新密码</label>
                    <input
                        type="password"
                        id="profile-new-password"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">确认新密码</label>
                    <input
                        type="password"
                        id="profile-confirm-password"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 px-6 py-3 gradient-bg text-white rounded-lg hover-scale">
                        确认修改
                    </button>
                    <button type="button" onclick="closeModal('change-password-modal')"
                            class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                        取消
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 历史记录弹窗 -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">搜索历史</h3>
                <button onclick="closeModal('history-modal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="search-history" class="space-y-2 max-h-96 overflow-y-auto">
                <!-- 历史记录将通过JavaScript动态添加 -->
            </div>
        </div>
    </div>

    <!-- 添加用户模态框 -->
    <div id="add-user-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
        <div class="bg-white rounded-xl p-6 w-96">
            <h3 class="text-xl font-semibold mb-4">添加新用户</h3>
            <form onsubmit="handleAddUser(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">用户名</label>
                    <input type="text" id="new-username" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">密码</label>
                    <input type="password" id="new-password" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">角色</label>
                    <select id="new-role" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <option value="user">普通用户</option>
                        <option value="admin">管理员</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeModal('add-user-modal')"
                        class="px-4 py-2 border rounded-md hover:bg-gray-50">取消</button>
                    <button type="submit"
                        class="px-4 py-2 gradient-bg text-white rounded-md hover:opacity-90">添加</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 修改其他用户密码弹窗 -->
    <div id="change-other-password-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">修改用户密码</h3>
                <button onclick="closeModal('change-other-password-modal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="change-other-password-form" class="space-y-4">
                <input type="hidden" id="target-username">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">新密码</label>
                    <input
                        type="password"
                        id="other-new-password"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                        required
                    />
                </div>
                <div class="flex space-x-4">
                    <button type="submit" class="flex-1 px-6 py-3 gradient-bg text-white rounded-lg hover-scale">
                        确认修改
                    </button>
                    <button type="button" onclick="closeModal('change-other-password-modal')"
                            class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">
                        取消
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 搜索历史弹窗 -->
    <div id="search-history-modal" class="modal">
        <div class="modal-content max-w-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">搜索历史</h3>
                <button onclick="closeModal('search-history-modal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4 max-h-[400px] overflow-y-auto" id="search-history-list">
                <!-- 搜索历史将通过 JavaScript 动态添加 -->
            </div>
        </div>
    </div>

    <!-- 用户管理弹窗 -->
    <div id="user-management-modal" class="modal">
        <div class="modal-content max-w-4xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">用户管理</h3>
                <button onclick="closeModal('user-management-modal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <!-- 用户列表 -->
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">用户名</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">角色</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">操作</th>
                            </tr>
                        </thead>
                        <tbody id="users-list" class="divide-y divide-gray-200">
                            <!-- 用户列表将通过 JavaScript 动态添加 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 添加用户按钮 -->
                <button onclick="showAddUserModal()" class="gradient-bg text-white px-4 py-2 rounded-lg hover:opacity-90">
                    <i class="fas fa-plus"></i> 添加用户
                </button>
            </div>
        </div>
    </div>

    <!-- 个人信息弹窗 -->
    <div id="profile-info-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold">个人信息</h3>
                <button onclick="closeModal('profile-info-modal')" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="flex justify-center mb-6">
                    <div class="w-24 h-24 bg-gradient-to-r from-indigo-500 to-blue-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-4xl text-white"></i>
                    </div>
                </div>
                <div class="text-center">
                    <h2 class="text-2xl font-semibold mb-2" id="profile-display-name"></h2>
                    <p class="text-gray-600" id="profile-role"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 从zm文件夹读取用户数据
        let users = [];
        
        // 加载用户数据
        async function loadUsers() {
            // 硬编码用户数据
            users = [
                {
                    username: "李建君",
                    password: "990708",
                    role: "admin"
                },
                {
                    username: "user",
                    password: "000000",
                    role: "user"
                }
            ];
            console.log('已加载用户数据:', users);
        }

        // 保存用户数据
        async function saveUsers() {
            try {
                await fetch('zm/users.json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(users)
                });
            } catch (error) {
                console.error('保存用户数据失败:', error);
            }
        }

        // AI选项数据
        const aiOptions = [
            {
                id: 'zhipu',
                name: '智谱 AI',
                description: '智谱 AI 开发的 GLM 大模型，擅长多轮对话',
                icon: 'fa-comments',
                apiKey: 'd1253e960a2542ea89d75f1443838ee1.qoTlhL7H75Kz1IuA'
            },
            {
                id: 'qwen',
                name: '通义千问',
                description: '阿里云大语言模型，擅长多语言和代码生成',
                icon: 'fa-lightbulb',
                apiKey: 'sk-b2ab33989c444e088030b4b233c8b935'
            },
            {
                id: 'ernie',
                name: '文心一言',
                description: '百度开发的大语言模型，擅长中文创作和理解',
                icon: 'fa-brain',
                apiKey: 'bce-v3/ALTAK-wv8hGe1D7z7Wo1yhg1BYd/5ff9b24892bc884975f4c6797f8ebaa16aed446f'
            },
            {
                id: 'spark',
                name: '星火认知',
                description: '讯飞星火认知大模型，擅长对话和知识问答',
                icon: 'fa-robot',
                apiKey: '816e6ebbef6174039b0dbaa7ebc7990b',
                apiSecret: 'ODk1ZjU1YzdmZmFmMDYwYjFmZWMzNzhl'
            }
        ];

        // 文字轮播逻辑
        function startTextSlider() {
            const slider = document.getElementById('text-slider');
            const slides = slider.children;
            let currentIndex = 0;
            const totalSlides = slides.length;

            // 设置初始状态
            slides[0].classList.add('active');

            setInterval(() => {
                // 移除当前激活状态
                slides[currentIndex].classList.remove('active');
                
                // 更新索引
                currentIndex = (currentIndex + 1) % totalSlides;
                
                // 添加新的激活状态
                slides[currentIndex].classList.add('active');
            }, 3000);
        }

        // 添加首次登录标记
        const defaultPassword = '990708';
        let isFirstLogin = false;

        let currentUser = null;
        let currentPassword = null;

        // 登录验证
        async function handleLogin(event) {
            event.preventDefault();
            console.log('尝试登录...');
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            console.log('输入的用户名:', username);
            console.log('输入的密码:', password);
            
            const user = users.find(u => u.username === username && u.password === password);
            console.log('找到的用户:', user);
            
            if (user) {
                currentUser = username;
                // 只有当密码是 000000 且不是李建君账号时才需要修改
                isFirstLogin = password === '000000' && username !== '李建君';
                
                if (isFirstLogin) {
                    showModal('change-password-modal');
                } else {
                    document.getElementById('login-section').style.display = 'none';
                    updateProfileInfo();
                    updateNavigation();
                }
            } else {
                alert('用户名或密码错误！');
            }
        }

        function updateProfileInfo() {
            const user = users.find(u => u.username === currentUser);
            document.getElementById('profile-username').textContent = currentUser;
            document.getElementById('profile-display-name').textContent = currentUser;
            document.getElementById('profile-role').textContent = user.role === 'admin' ? '管理员' : '普通用户';
            
            // 如果是管理员，显示用户管理按钮
            const adminButton = document.getElementById('admin-button');
            if (user.role === 'admin') {
                adminButton.classList.remove('hidden');
                updateUsersList();
            } else {
                adminButton.classList.add('hidden');
            }
        }

        // 更新用户列表
        function updateUsersList() {
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = users.map(user => `
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">${user.username}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${user.role}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <button onclick="showChangeOtherPasswordModal('${user.username}')"
                            class="text-blue-600 hover:text-blue-800 mr-3 ${user.username === currentUser ? 'hidden' : ''}">
                            <i class="fas fa-key"></i>
                        </button>
                        <button onclick="deleteUser('${user.username}')" 
                            class="text-red-600 hover:text-red-800 ${user.username === currentUser ? 'hidden' : ''}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // 显示添加用户模态框
        function showAddUserModal() {
            showModal('add-user-modal');
        }

        // 处理添加用户
        async function handleAddUser(event) {
            event.preventDefault();
            const username = document.getElementById('new-username').value;
            const password = document.getElementById('new-password').value;
            const role = document.getElementById('new-role').value;
            
            if (users.some(u => u.username === username)) {
                alert('用户名已存在！');
                return;
            }
            
            // 如果没有输入密码，则使用默认密码 000000
            const finalPassword = password || '000000';
            
            users.push({ username, password: finalPassword, role });
            await saveUsers();
            updateUsersList();
            closeModal('add-user-modal');
            event.target.reset();
        }

        // 删除用户
        async function deleteUser(username) {
            if (!confirm(`确定要删除用户 "${username}" 吗？`)) {
                return;
            }
            
            users = users.filter(u => u.username !== username);
            await saveUsers();
            updateUsersList();
        }

        // 处理创建新用户
        function handleCreateUser(e) {
            e.preventDefault();
            const newUsername = document.getElementById('new-username').value.trim();

            if (!newUsername) {
                alert('请输入用户名');
                return;
            }

            if (users.some(u => u.username === newUsername)) {
                alert('用户名已存在');
                return;
            }

            // 创建新用户
            users.push({
                username: newUsername,
                password: defaultPassword,
                isAdmin: false
            });

            // 保存到文件
            saveUsers();

            alert('用户创建成功！');
            e.target.reset();
            updateUsersList();
        }

        // 显示修改密码界面
        function showChangePasswordForm() {
            const loginForm = document.querySelector('#login-form');
            loginForm.innerHTML = `
                <div class="text-center mb-4">
                    <p class="text-gray-600">检测到您正在使用初始密码，请修改密码</p>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">新密码</label>
                        <input
                            type="password"
                            id="new-password"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            required
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">确认新密码</label>
                        <input
                            type="password"
                            id="confirm-password"
                            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500"
                            required
                        />
                    </div>
                    <button
                        onclick="handlePasswordChange(event)"
                        class="w-full px-6 py-3 gradient-bg text-white rounded-lg hover-scale"
                    >
                        确认修改
                    </button>
                </div>
            `;
        }

        // 处理密码修改
        function handlePasswordChange(e) {
            e.preventDefault();
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;

            if (!newPassword || newPassword.length < 6) {
                alert('新密码长度不能少于6位');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('两次输入的密码不一致');
                return;
            }

            // 更新用户密码
            const user = users.find(u => u.username === currentUser);
            if (user) {
                user.password = newPassword;
                currentPassword = newPassword;
            }

            document.getElementById('login-section').style.display = 'none';
            updateProfileInfo();
        }

        // 处理个人主页密码修改
        function handleProfilePasswordChange(e) {
            e.preventDefault();
            const currentPasswordInput = document.getElementById('current-password').value;
            const newPassword = document.getElementById('profile-new-password').value;
            const confirmPassword = document.getElementById('profile-confirm-password').value;

            if (currentPasswordInput !== currentPassword) {
                alert('当前密码输入错误');
                return;
            }

            if (!newPassword || newPassword.length < 6) {
                alert('新密码长度不能少于6位');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('两次输入的密码不一致');
                return;
            }

            // 更新用户密码
            const user = users.find(u => u.username === currentUser);
            if (user) {
                user.password = newPassword;
            }
            currentPassword = newPassword;
            alert('密码修改成功！');
            e.target.reset();
        }

        // 初始化页面
        async function initializePage() {
            console.log('初始化页面...');
            await loadUsers();
            console.log('用户数据加载完成');
            
            // 添加登录表单提交事件监听
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                console.log('已添加登录表单事件监听');
            } else {
                console.error('未找到登录表单元素');
            }
            
            // 渲染AI选项
            const aiOptionsContainer = document.getElementById('ai-options');
            aiOptions.forEach(ai => {
                const div = document.createElement('div');
                div.className = 'flex items-center space-x-3 bg-white/80 backdrop-blur-sm p-4 rounded-xl shadow-sm hover:shadow-md transition-all flex-1 hover-scale';
                div.innerHTML = `
                    <input
                        type="checkbox"
                        id="${ai.id}"
                        class="mt-1"
                        checked
                    />
                    <label for="${ai.id}" class="cursor-pointer flex-1">
                        <div class="flex items-center space-x-2">
                            <i class="fas ${ai.icon} text-indigo-600"></i>
                            <div class="font-medium text-gray-900">${ai.name}</div>
                        </div>
                        <div class="text-sm text-gray-500 mt-1">${ai.description}</div>
                    </label>
                `;
                aiOptionsContainer.appendChild(div);
            });

            // 启动文字轮播
            startTextSlider();
            
            // 显示首页
            showSection('home');
            
            // 设置联系表单提交事件
            document.getElementById('contact-form')?.addEventListener('submit', handleContactSubmit);
            document.getElementById('change-password-form')?.addEventListener('submit', handleChangePassword);
        }

        // 切换页面显示
        function showSection(sectionId) {
            // 隐藏所有部分
            document.getElementById('home-section').classList.add('hidden');
            document.getElementById('about-section').classList.add('hidden');
            document.getElementById('profile-section').classList.add('hidden');

            // 移除所有导航按钮的激活状态
            document.getElementById('nav-home').classList.remove('text-blue-600');
            document.getElementById('nav-about').classList.remove('text-blue-600');
            document.getElementById('nav-profile').classList.remove('text-blue-600');

            // 显示选中的部分
            document.getElementById(`${sectionId}-section`).classList.remove('hidden');
            document.getElementById(`nav-${sectionId}`).classList.add('text-blue-600');
        }

        // 添加历史记录数组
        let searchHistory = [];
        const MAX_HISTORY = 20;

        // 添加历史记录到个人主页
        function addHistorySection() {
            // 移除这个函数，不再需要在个人主页添加历史记录部分
        }

        // 更新历史记录显示
        function updateSearchHistory() {
            const historyContainer = document.getElementById('search-history');
            if (!searchHistory.length) {
                historyContainer.innerHTML = '<div class="text-gray-500 text-center py-4">暂无搜索记录</div>';
                return;
            }

            historyContainer.innerHTML = searchHistory.map((item, index) => `
                <div class="bg-gray-50 p-4 rounded-lg hover:bg-gray-100 transition-colors">
                    <div class="text-sm text-gray-500">${new Date(item.timestamp).toLocaleString()}</div>
                    <div class="font-medium mt-1">${item.question}</div>
                    <div class="text-sm text-gray-600">使用的AI: ${item.ais.join(', ')}</div>
                </div>
            `).join('');
        }

        // 添加暂停标志
        let isPaused = false;
        let currentControllers = [];  // 存储 AbortController 实例

        // 修改问题提交函数
        async function handleSubmitQuestion() {
            const question = document.getElementById('question-input').value.trim();
            const selectedAIs = Array.from(document.querySelectorAll('#ai-options input[type="checkbox"]:checked'))
                .map(checkbox => checkbox.id);

            if (!question || selectedAIs.length === 0) {
                alert('请输入问题并选择至少一个AI接口');
                return;
            }

            // 显示响应容器
            document.getElementById('responses-container').classList.remove('hidden');

            // 如果已经在回答中，则显示暂停按钮
            const submitButton = document.getElementById('submit-button');
            submitButton.innerHTML = '<i class="fas fa-stop"></i> 停止回答';
            submitButton.onclick = handlePause;

            // 清空之前的回答
            const responsesList = document.getElementById('responses-list');
            responsesList.innerHTML = '';

            // 清空之前的控制器
            currentControllers = [];

            // 创建所有 AI 的响应 Promise
            const aiPromises = selectedAIs.map(async aiId => {
                // 为每个请求创建 AbortController
                const controller = new AbortController();
                currentControllers.push(controller);
                const signal = controller.signal;

                const ai = aiOptions.find(ai => ai.id === aiId);
                const responseDiv = document.createElement('div');
                responseDiv.className = 'bg-white/80 backdrop-blur-sm p-6 rounded-xl shadow-sm hover:shadow-md transition-all hover-scale';
                
                responseDiv.innerHTML = `
                    <div class="font-medium gradient-text mb-3 flex items-center space-x-2">
                        <i class="fas ${ai.icon}"></i>
                        <span>${ai.name}</span>
                    </div>
                    <div id="response-${aiId}" class="text-gray-600">
                        正在思考...
                    </div>
                `;
                responsesList.appendChild(responseDiv);

                // 返回每个 AI 的调用 Promise
                if (aiId === 'zhipu') {
                    return handleZhipuResponse(aiId, question, signal);
                } else if (aiId === 'qwen') {
                    return handleQwenResponse(aiId, question, signal);
                } else if (aiId === 'ernie') {
                    return handleErnieResponse(aiId, question, signal);
                } else if (aiId === 'spark') {
                    // 如果星火认知无法调用，直接返回提示
                    document.getElementById(`response-${aiId}`).textContent = '抱歉，星火认知接口暂时无法使用';
                    return Promise.resolve();
                }
            });

            // 同时等待所有 AI 的响应
            try {
                await Promise.allSettled(aiPromises);
            } finally {
                // 恢复提交按钮状态
                submitButton.innerHTML = '<i class="fas fa-paper-plane"></i> 发送';
                submitButton.onclick = handleSubmitQuestion;
                isPaused = false;
                currentControllers = [];
            }

            // 添加到历史记录
            searchHistory.unshift({
                question,
                ais: selectedAIs.map(id => aiOptions.find(ai => ai.id === id).name),
                timestamp: new Date().getTime()
            });

            // 保持最多20条记录
            if (searchHistory.length > MAX_HISTORY) {
                searchHistory = searchHistory.slice(0, MAX_HISTORY);
            }

            // 如果历史记录弹窗正在显示，则更新其内容
            if (document.getElementById('history-modal').style.display === 'flex') {
                updateSearchHistory();
            }

            // 保存搜索历史
            const history = JSON.parse(localStorage.getItem(`searchHistory_${currentUser}`) || '[]');
            history.push({
                question,
                timestamp: Date.now()
            });
            localStorage.setItem(`searchHistory_${currentUser}`, JSON.stringify(history));
        }

        // 暂停回答功能
        function handlePause() {
            isPaused = true;
            // 中断所有正在进行的请求
            currentControllers.forEach(controller => {
                controller.abort();
            });
            
            // 恢复提交按钮状态
            const submitButton = document.getElementById('submit-button');
            submitButton.innerHTML = '<i class="fas fa-paper-plane"></i> 发送';
            submitButton.onclick = handleSubmitQuestion;
        }

        // 文心一言的响应处理函数
        async function handleErnieResponse(aiId, question, signal) {
            try {
                const response = await fetch('https://cors-anywhere.herokuapp.com/https://aip.baidubce.com/oauth/2.0/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Accept': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    signal,
                    body: new URLSearchParams({
                        'grant_type': 'client_credentials',
                        'client_id': 'rci2qKP8IxKT3hDPrGHg0VvX',
                        'client_secret': 'SkvkDNF2T4nupOq1IOF70zSKfLZ5hZpD'
                    })
                });

                if (!response.ok) {
                    throw new Error('获取访问令牌失败');
                }

                const tokenData = await response.json();
                const accessToken = tokenData.access_token;

                const chatResponse = await fetch(`https://cors-anywhere.herokuapp.com/https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/chat/completions?access_token=${accessToken}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "ernie-bot-4",
                        messages: [
                            {
                                role: "assistant",
                                content: "我是一个乐于助人的AI助手。"
                            },
                            {
                                role: "user",
                                content: question
                            }
                        ],
                        stream: false,
                        temperature: 0.95,
                        top_p: 0.8,
                        presence_penalty: 1.0,
                        frequency_penalty: 1.0,
                        user_id: currentUser || "test_user"
                    })
                });

                if (!chatResponse.ok) {
                    const errorText = await chatResponse.text();
                    console.error('文心一言错误响应:', errorText);
                    throw new Error(`HTTP error! status: ${chatResponse.status}`);
                }

                const data = await chatResponse.json();
                console.log('文心一言响应数据:', data);
                
                if (data.error_code) {
                    throw new Error(data.error_msg || data.msg || '调用失败');
                }
                
                const responseText = data.result || '抱歉，生成回答时出现错误';
                document.getElementById(`response-${aiId}`).textContent = responseText;

            } catch (error) {
                console.error('文心一言API调用失败:', error);
                document.getElementById(`response-${aiId}`).textContent = `抱歉，调用AI接口时出现错误: ${error.message}`;
            }
        }

        // 星火认知的响应处理函数
        async function handleSparkResponse(aiId, question, signal) {
            try {
                // 模拟 AI 响应
                function simulateAIResponse(message) {
                    return new Promise(async (resolve, reject) => {
                        try {
                            // 构建请求数据
                            const requestData = {
                                header: {
                                    app_id: "ed7b479b"
                                },
                                parameter: {
                                    chat: {
                                        domain: "general",
                                        temperature: 0.7,
                                        max_tokens: 4096
                                    }
                                },
                                payload: {
                                    message: {
                                        text: [
                                            {
                                                role: "user",
                                                content: message
                                            }
                                        ]
                                    }
                                }
                            };

                            // 计算认证信息
                            const apiKey = "816e6ebbef6174039b0dbaa7ebc7990b";
                            const apiSecret = "ODk1ZjU1YzdmZmFmMDYwYjFmZWMzNzhl";
                            const host = "spark-api.xf-yun.com";
                            const date = new Date().toGMTString();
                            const signature = CryptoJS.HmacSHA256(
                                `host: ${host}\ndate: ${date}\nPOST /v1.1/chat HTTP/1.1`,
                                apiSecret
                            ).toString(CryptoJS.enc.Base64);

                            const authorization = `api_key="${apiKey}", algorithm="hmac-sha256", headers="host date request-line", signature="${signature}"`;

                            const response = await fetch('https://spark-api.xf-yun.com/v1.1/chat', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': authorization,
                                    'Host': host,
                                    'Date': date
                                },
                                body: JSON.stringify(requestData)
                            });

                            if (!response.ok) {
                                const errorText = await response.text();
                                console.error('星火认知错误响应:', errorText);
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }

                            const data = await response.json();
                            console.log('星火认知响应数据:', data);
                            
                            if (data.header.code !== 0) {
                                throw new Error(data.header.message || '调用失败');
                            }
                            
                            const responseText = data.payload.choices.text[0].content;
                            resolve(responseText);

                        } catch (error) {
                            console.error('星火认知API调用失败:', error);
                            reject(new Error(`星火认知API调用失败: ${error.message}`));
                        }
                    });
                }

                const responseText = await simulateAIResponse(question);
                document.getElementById(`response-${aiId}`).textContent = responseText;

            } catch (error) {
                console.error('星火认知API调用失败:', error);
                document.getElementById(`response-${aiId}`).textContent = `抱歉，调用AI接口时出现错误: ${error.message}`;
            }
        }

        // 通义千问的响应处理函数
        async function handleQwenResponse(aiId, question, signal) {
            try {
                const response = await fetch('https://cors-anywhere.herokuapp.com/https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': 'https://dashscope.aliyuncs.com',
                        'X-Requested-With': 'XMLHttpRequest',
                        'Authorization': 'Bearer sk-b2ab33989c444e088030b4b233c8b935'
                    },
                    body: JSON.stringify({
                        model: 'qwen-plus',
                        input: {
                            messages: [
                                {
                                    role: 'system',
                                    content: 'You are a helpful assistant.'
                                },
                                {
                                    role: 'user',
                                    content: question
                                }
                            ]
                        },
                        parameters: {
                            result_format: 'message'
                        }
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('通义千问错误响应:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                }

                const data = await response.json();
                console.log('通义千问响应数据:', data);

                if (!data.output?.choices?.[0]?.message?.content) {
                    throw new Error(data.message || '调用失败');
                }
                
                const responseText = data.output?.choices?.[0]?.message?.content || '抱歉，生成回答时出现错误';
                document.getElementById(`response-${aiId}`).textContent = responseText;

            } catch (error) {
                console.error('通义千问API调用失败:', error);
                document.getElementById(`response-${aiId}`).textContent = `抱歉，调用AI接口时出现错误: ${error.message}`;
            }
        }

        // 智谱 AI 的响应处理函数
        async function handleZhipuResponse(aiId, question, signal) {
            try {
                const apiKey = aiOptions.find(ai => ai.id === 'zhipu').apiKey;
                const [id, secret] = apiKey.split('.');
                
                // 生成 JWT token
                const payload = {
                    api_key: id,
                    exp: Date.now() + 3600 * 1000,  // 1小时后过期
                    timestamp: Date.now()
                };
                
                const token = jwt_encode(payload, secret, {
                    algorithm: 'HS256',
                    header: { alg: 'HS256', sign_type: 'SIGN' }
                });

                const response = await fetch('https://cors-anywhere.herokuapp.com/https://open.bigmodel.cn/api/paas/v4/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`,
                        'Origin': 'https://open.bigmodel.cn',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({
                        model: 'glm-4',
                        messages: [
                            {
                                role: 'system',
                                content: '你是一个乐于助人的AI助手。'
                            },
                            {
                                role: 'user',
                                content: question
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 4096,
                        top_p: 0.8,
                        stream: false
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('智谱 AI 错误响应:', errorText);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('智谱 AI 响应数据:', data);
                
                if (!data.choices?.[0]?.message?.content) {
                    throw new Error(data.error?.message || '调用失败');
                }
                
                const responseText = data.choices[0].message.content;
                document.getElementById(`response-${aiId}`).textContent = responseText;

            } catch (error) {
                console.error('智谱 AI 调用失败:', error);
                document.getElementById(`response-${aiId}`).textContent = `抱歉，调用AI接口时出现错误: ${error.message}`;
            }
        }

        // JWT 编码函数
        function jwt_encode(payload, secret, options = {}) {
            const header = options.header || { alg: 'HS256', typ: 'JWT' };
            
            const encodeBase64 = (str) => {
                return btoa(unescape(encodeURIComponent(str)))
                    .replace(/=/g, '')
                    .replace(/\+/g, '-')
                    .replace(/\//g, '_');
            };
            
            const stringifiedHeader = JSON.stringify(header);
            const encodedHeader = encodeBase64(stringifiedHeader);
            
            const stringifiedPayload = JSON.stringify(payload);
            const encodedPayload = encodeBase64(stringifiedPayload);
            
            const signature = CryptoJS.HmacSHA256(
                `${encodedHeader}.${encodedPayload}`,
                secret
            ).toString(CryptoJS.enc.Base64)
                .replace(/=/g, '')
                .replace(/\+/g, '-')
                .replace(/\//g, '_');
            
            return `${encodedHeader}.${encodedPayload}.${signature}`;
        }

        // 处理联系表单提交
        function handleContactSubmit(e) {
            e.preventDefault();
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                message: document.getElementById('message').value
            };
            
            console.log('提交的表单数据：', formData);
            alert('消息已发送！');
            
            // 重置表单
            e.target.reset();
        }

        // 添加弹窗控制函数
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            // 如果是历史记录弹窗，则更新内容
            if (modalId === 'history-modal') {
                updateSearchHistory();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // 显示修改其他用户密码弹窗
        function showChangeOtherPasswordModal(username) {
            document.getElementById('target-username').value = username;
            showModal('change-other-password-modal');
        }

        // 处理修改其他用户密码
        document.getElementById('change-other-password-form').addEventListener('submit', async function(event) {
            event.preventDefault();
            const username = document.getElementById('target-username').value;
            const newPassword = document.getElementById('other-new-password').value;
            
            const user = users.find(u => u.username === username);
            if (user) {
                user.password = newPassword;
                await saveUsers();
                alert('密码修改成功！');
                closeModal('change-other-password-modal');
                event.target.reset();
            }
        });

        // 更新搜索历史
        function updateSearchHistory() {
            const historyList = document.getElementById('search-history-list');
            const history = JSON.parse(localStorage.getItem(`searchHistory_${currentUser}`) || '[]');
            const recentHistory = history.slice(-20).reverse(); // 获取最近20条记录
            
            historyList.innerHTML = recentHistory.map(item => `
                <div class="bg-white p-4 rounded-lg shadow-sm">
                    <div class="text-sm text-gray-500 mb-2">${new Date(item.timestamp).toLocaleString()}</div>
                    <div class="font-medium">${item.question}</div>
                </div>
            `).join('') || '<div class="text-gray-500 text-center">暂无搜索记录</div>';
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html> 